<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="viewport"
      charset="utf-8"
      content="width=device-width, initial-scale=1, user-scalable=yes"
    />
    <title>PVZero</title>
    <style>
      table {
        border: 2px solid rgb(140 140 140);
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid rgb(160 160 160);
        border-collapse: collapse;
        text-align: center;
        padding: 5px;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/base.css" />
  </head>

  <body style="padding-top: 58px">
    <div id="header"></div>
    <div class="base-panel">
      <br />
      <span id="pvzero_title" style="font-weight: bold; font-size: 2em">
        PVZero
      </span>
      <span id="version">Unknown</span>
      <div class="line_named"></div>
      <div id="shelly_3em" class="noorder">
        <form>
          <div>
            <input
              id="autoupdate"
              type="checkbox"
              name="autoupdate"
              value="true"
              checked
              onclick="handleClickAutoUpdate(this);"
            />
            <label id="lbl_autoupdate">jede Sekunde aktualisieren</label>
          </div>
        </form>
        <div style="display: flex; align-items: center">
          <span class="material-icons" style="padding-right: 10px">
            solar_power
          </span>
          <div id="feed_in_power" style="padding-bottom: 0px">- W</div>
          <div
            style="padding-left: 10px; padding-right: 10px; padding-bottom: 0px"
          >
            &rarr;
          </div>
          <div id="total_consumption" style="padding-bottom: 0px">- W</div>
          <div
            style="padding-left: 10px; padding-right: 10px; padding-bottom: 0px"
          >
            &larr;
          </div>
          <div id="consumption_power" style="padding-bottom: 0px">- W</div>
          <span class="material-icons" style="padding-left: 10px"> house </span>
          <!-- <span class="material-icons" style="padding-left: 10px">
            swipe_left_alt
          </span> -->
          <span
            class="material-icons"
            style="padding-left: 10px; font-size: 0.8em"
          >
            update
          </span>
          <div
            id="check_interval"
            style="padding-left: 3px; padding-bottom: 0px; font-size: 0.8em"
          ></div>
        </div>

        <div style="display: flex; align-items: center">
          <div style="padding-left: 10px; padding-bottom: 0px">&#10551;</div>
          <span class="material-icons"> battery_std </span>
          <div id="battery_current" style="padding-bottom: 0px">- A</div>
          <div
            style="padding-left: 10px; padding-right: 10px; padding-bottom: 0px"
          >
            &rarr;
          </div>
          <div id="battery_current_sum_in" style="padding-bottom: 0px">
            - Ah
          </div>
          <div
            style="padding-left: 10px; padding-right: 10px; padding-bottom: 0px"
          >
            &rarr;
          </div>
          <div id="battery_current_sum_out" style="padding-bottom: 0px">
            - Ah
          </div>
        </div>

        <div class="line_named_h3">Leistungssteuerung</div>
        <table>
          <thead>
            <tr>
              <th scope="col" rowspan="1"></th>
              <th scope="col" colspan="3">actual</th>
              <th scope="col" colspan="3">target</th>
            </tr>
            <!-- <tr>
              <th scope="col">W</th>
              <th scope="col">V</th>
              <th scope="col">A</th>
              <th scope="col">W</th>
              <th scope="col">V</th>
              <th scope="col">A</th>
            </tr> -->
          </thead>
          <body>
            <tr>
              <th>MPPT</th>
              <td id="mppt_w">-</td>
              <td id="mppt_v">-</td>
              <td id="mppt_a">-</td>
              <td id="mppt_target_w">-</td>
              <td id="mppt_target_v">-</td>
              <td id="mppt_target_a">-</td>
            </tr>
            <tr>
              <th>PSU1</th>
              <td id="psu1_w">-</td>
              <td id="psu1_v">-</td>
              <td id="psu1_a">-</td>
              <td id="psu1_target_w">-</td>
              <td id="psu1_target_v">-</td>
              <td id="psu1_target_a">-</td>
            </tr>
            <tr>
              <th>PSU2</th>
              <td id="psu2_w">-</td>
              <td id="psu2_v">-</td>
              <td id="psu2_a">-</td>
              <td id="psu2_target_w">-</td>
              <td id="psu2_target_v">-</td>
              <td id="psu2_target_a">-</td>
            </tr>
            <tr>
              <th>Analog</th>
              <td id="analog_w">-</td>
              <td id="analog_v">-</td>
              <td id="analog_a">-</td>
              <td id="analog_target_w">-</td>
              <td id="analog_target_v">-</td>
              <td id="analog_target_a">-</td>
            </tr>
          </body>
        </table>

        <div class="line_named_h3">Speicher</div>
        <div id="mppt_state" style="padding-bottom: 0px"></div>
        <div id="battery_state" style="padding-bottom: 0px"></div>
        <label id="info_battery_state"></label>
        <div>
          <div class="line_named_h4">Bedingungen für Zustandsübergänge:</div>
          <ol>
            <li>Charge Voltage >= CHARGE_CUTOFF_VOLTAGE (58.4 V)</li>
            <li>Charge Voltage < (CHARGE_CUTOFF_VOLTAGE - 0.4V) (58.0 V)</li>
            <li>Charge Voltage <= (DISCHARGE_VOLTAGE) (42.0 V)</li>
            <li>
              (Charge Voltage > (ABSORPTION_VOLTAGE) (51.2 V)) && (Charge
              Current > 0.1 A)
            </li>
            <li>Charge Current < 0.2 A</li>
            <li>Charge Current > 0.5 A</li>
            <li>Charge Voltage >= (CHARGE_CUTOFF_VOLTAGE - 5.0 V)</li>
            <li>Charge Voltage <= ABSORPTION_VOLTAGE (51.2)</li>
            <li>(Zeitstempel - GespeicherterZeitstempel) > 2 Wochen</li>
            <li>Charge Voltage >= CHARGE_CUTOFF_VOLTAGE (58.4 V)</li>
          </ol>
        </div>
      </div>
      <br />
    </div>
    <script src="/js/postload.js"></script>
    <script src="/js/pvz.js"></script>
    <script type="text/javascript">
      function handleClickAutoUpdate(cb) {
        if (cb.checked) {
          console.log(`enable auto update`);
          timerRefresh = setTimeout(
            getJSON.bind(null, "/pvz/state.json", "fillPVZeroState"),
            1000
          );
        } else {
          console.log(`disable auto update`);
          clearTimeout(timerRefresh);
        }
      }
    </script>
  </body>
</html>
