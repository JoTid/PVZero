#include <Arduino.h>
#include <unity.h>

#include <pvz_psu.hpp>

/**
 * @brief The PSU class to test
 */
PvzPsu aclPsuG[2];

/*--------------------------------------------------------------------------------------------------------------------*\
** Prepare tests                                                                                                      **
**                                                                                                                    **
\*--------------------------------------------------------------------------------------------------------------------*/
void setUp(void)
{
  // The setUp function can contain anything you would like to run before each test.
}

void tearDown(void)
{
  // The tearDown function can contain anything you would like to run after each test.
}

/*--------------------------------------------------------------------------------------------------------------------*\
** Implement tests cases                                                                                              **
**                                                                                                                    **
\*--------------------------------------------------------------------------------------------------------------------*/
void test_psu_parameter_init(void)
{
}

void test_psu_A_init(void)
{
  //---------------------------------------------------------------------------------------------------
  // initialise the PSU A
  //
  TEST_ASSERT_EQUAL(aclPsuG[1].init(Serial2), 24);
}

void test_psu_B_init(void)
{
  //---------------------------------------------------------------------------------------------------
  // initialise the PSU B
  //
  TEST_ASSERT_EQUAL(aclPsuG[0].init(Serial1), 24);
}

/*--------------------------------------------------------------------------------------------------------------------*\
** Test environment                                                                                                   **
**                                                                                                                    **
\*--------------------------------------------------------------------------------------------------------------------*/

//--------------------------------------------------------------------------------------------------------------------//
//                                                                                                                    //
//                                                                                                                    //
//--------------------------------------------------------------------------------------------------------------------//
void setup()
{
  // NOTE!!! Wait for >2 secs
  // if board doesn't support software reset via Serial.DTR/RTS
  delay(2000);

  UNITY_BEGIN(); // IMPORTANT LINE!

  RUN_TEST(test_psu_parameter_init);
}

//--------------------------------------------------------------------------------------------------------------------//
//                                                                                                                    //
//                                                                                                                    //
//--------------------------------------------------------------------------------------------------------------------//
void loop()
{
  //---------------------------------------------------------------------------------------------------
  // run tests step by step,
  //
  // The sequence of the following tests must be adhered to in order to pass them!
  //
  RUN_TEST(test_psu_A_init);
  RUN_TEST(test_psu_B_init);

  UNITY_END(); // stop unit testing

  while (1)
  {
  };
}