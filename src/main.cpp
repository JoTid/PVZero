#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>
#include "lcd.hpp"
#include "led.hpp"

/*--------------------------------------------------------------------------------------------------------------------*\
** Global modules                                                                                                     **
**                                                                                                                    **
\*--------------------------------------------------------------------------------------------------------------------*/ 

/**
 * @brief Application LCD software module
 * 
 */
LCD *pclAppLcdG;

//--------------------------------------------------------------------------------------------------------------------//
//                                                                                                                    //
//                                                                                                                    //
//--------------------------------------------------------------------------------------------------------------------// 
void setup() {
   //--------------------------------------------------------------------------------------------------- 
   // initialise LED
   //
   ledInit();
   ledSet(0, true);

   //--------------------------------------------------------------------------------------------------- 
   // Use serial interface for debug
   //
   Serial.begin(115200); // Setup serial object and define transmission speed
   Serial.println("Starting setup...");
   Serial.printf_P(PSTR("Time: %d\n"), millis()); // using PROGMEM

   //--------------------------------------------------------------------------------------------------- 
   // initialise the LCD
   //
   pclAppLcdG = new LCD();
   pclAppLcdG->init();
}


//--------------------------------------------------------------------------------------------------------------------//
//                                                                                                                    //
//                                                                                                                    //
//--------------------------------------------------------------------------------------------------------------------// 
void loop() {
   static uint32_t ulLedTimeS = millis(); 

   //--------------------------------------------------------------------------------------------------- 
   // toggle LED
   //
   if (millis() > (ulLedTimeS + 500))
   {
      ulLedTimeS = millis();
      if (ledIsOn(0))
      {
         ledSet(0, false);
      }
      else
      {
         ledSet(0, true);
      }
   }

   //--------------------------------------------------------------------------------------------------- 
   // Trigger the application LCD
   //
   pclAppLcdG->process();

}
